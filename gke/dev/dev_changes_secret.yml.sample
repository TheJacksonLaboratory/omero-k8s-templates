apiVersion: v1
kind: Pod
metadata:
  name: omero-server
spec:
  containers:
    - name: omero-server
      image: us-east1-docker.pkg.dev/<GCP PROJECT NAME>/template-test-repo/omero-server:latest
      env:
        - name: CONFIG_omero_db_name
          value: omero-database
        - name: CONFIG_omero_db_host
          value: <DATABASE IP>
      lifecycle:
        postStart:
          exec:
            command: ["gcsfuse", "omero-bucket", "/data_mount"]
  volumes:
    - name: files-mount
      nfs: 
        server: <NFS IP>
        path: /mountdir

---

apiVersion: apps/v1
kind: Deployment
metadata:
  name: omero-readonly-server
spec:
  template:
    spec:
      containers:
        - name: omero-readonly-server
          image: us-east1-docker.pkg.dev/<GCP PROJECT NAME>/template-test-repo/omero-server:latest
          env:
            - name: CONFIG_omero_db_name
              value: omero-database
            - name: CONFIG_omero_db_host
              value: <DATABASE IP>
          lifecycle:
            postStart:
              exec:
                command: ["gcsfuse","-o","ro","omero-bucket", "/data_mount"]
      volumes:
        - name: files-mount
          nfs: 
            server: <NFS IP>
            path: /mountdir

---

apiVersion: apps/v1
kind: Deployment
metadata:
  name: omero-web
spec:
  template:
    spec:
      containers:
        - name: omero-web
          image: us-east1-docker.pkg.dev/<GCP PROJECT NAME>/template-test-repo/omero-web:latest
